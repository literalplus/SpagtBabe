From 0f98d58d34d51b38bd8514688c7b198e581cf99b Mon Sep 17 00:00:00 2001
From: xxyy <devnull@nowak-at.net>
Date: Tue, 11 Mar 2014 19:22:15 +0100
Subject: [PATCH] Improve admin tools

Signed-off-by: xxyy <devnull@nowak-at.net>
---
 core/irc.py      |  4 ++--
 plugins/admin.py | 32 ++++++++++++++++++++------------
 2 files changed, 22 insertions(+), 14 deletions(-)

diff --git a/core/irc.py b/core/irc.py
index c3f34a6..3041b06 100644
--- a/core/irc.py
+++ b/core/irc.py
@@ -257,9 +257,9 @@ class IRC(object):
         if channel not in self.channels:
             self.channels.append(channel)
 
-    def part(self, channel):
+    def part(self, channel, reason=None):
         """ makes the bot leave a channel """
-        self.cmd("PART", [channel])
+        self.cmd("PART", [channel, reason])
         if channel in self.channels:
             self.channels.remove(channel)
 
diff --git a/plugins/admin.py b/plugins/admin.py
index 4a67adc..ed0f3e5 100644
--- a/plugins/admin.py
+++ b/plugins/admin.py
@@ -112,7 +112,7 @@ def stop(inp, nick=None, conn=None):
     else:
         conn.cmd("QUIT", ["Killed by {}.".format(nick)])
     time.sleep(5)
-    os.execl("./cloudbot", "cloudbot", "stop")
+    os.execl("spagtbabe", "cloudbot", "stop")
 
 
 @hook.command(autohelp=False, permissions=["botcontrol"])
@@ -133,7 +133,7 @@ def restart(inp, nick=None, conn=None, bot=None):
 @hook.command(autohelp=False, permissions=["botcontrol"])
 def clearlogs(inp, input=None):
     """clearlogs -- Clears the bots log(s)."""
-    subprocess.call(["./cloudbot", "clear"])
+    subprocess.call(["spagtbabe", "clear"])
 
 
 @hook.command(permissions=["botcontrol"])
@@ -147,19 +147,27 @@ def join(inp, conn=None, notice=None):
 
 
 @hook.command(autohelp=False, permissions=["botcontrol"])
-def part(inp, conn=None, chan=None, notice=None):
-    """part <channel> -- Leaves <channel>.
+def part(inp, conn=None, chan=None, notice=None, bot=None, nick=None):
+    """part <channel> [reason] -- Leaves <channel>.
     If [channel] is blank the bot will leave the
     channel the command was used in."""
-    if inp:
-        targets = inp
+
+    if not inp:
+        inp = chan
+
+    if " " in inp:
+        inpArr = inp.split(" ", 1)
+        target = inpArr[0]
+        reason = inpArr[1]
     else:
-        targets = chan
-    for target in targets.split(" "):
-        if not target.startswith("#"):
-            target = "#{}".format(target)
-        notice("Attempting to leave {}...".format(target))
-        conn.part(target)
+        target = inp
+        try:
+            reason = bot.config["plugins"]["admin"].get("default-part-reason", "such part")
+        except KeyError:
+            reason = "many part"
+
+    notice("Attempting to leave {} ({})...".format(target, reason))
+    conn.part(target, "({}) {}".format(nick, reason))
 
 
 @hook.command(autohelp=False, permissions=["botcontrol"])
-- 
1.8.3.msysgit.0

