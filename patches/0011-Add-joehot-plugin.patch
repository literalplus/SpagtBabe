From 5ac3b2225c7f7976fbbbec3486f36684a2a26c9e Mon Sep 17 00:00:00 2001
From: xxyy <devnull@nowak-at.net>
Date: Wed, 12 Mar 2014 23:02:55 +0100
Subject: [PATCH] Add joehot plugin

---
 plugins/joehot.py | 58 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 58 insertions(+)
 create mode 100644 plugins/joehot.py

diff --git a/plugins/joehot.py b/plugins/joehot.py
new file mode 100644
index 0000000..6fa0b3c
--- /dev/null
+++ b/plugins/joehot.py
@@ -0,0 +1,58 @@
+#Based on an implementation by LaxWasHere
+from util import hook
+import random
+import requests
+
+QUOTE_SOURCE = "http://xxyy.github.io/jhq-server/joehot.qt.txt"
+
+joehots = []
+
+@hook.command(autohelp=False)
+def joehot(inp, notice=None):
+    """joehot - joehot quote service.
+    Available commands: reload, count, source, purpose, [quote id].
+    Pass no arguments for a random quote."""
+
+
+    if "reload" in inp:
+        notice("Reloading quotes!")
+        suc = refetch_quotes()
+        notice("Successfully reloaded quotes!" if suc else "Failed reloading quotes!")
+        notice(str(len(joehots)) + " quotes loaded.")
+        return
+    elif "count" in inp:
+        return str(len(joehots)) + " quotes loaded."
+    elif "source" in inp:
+        return "See all the quotes at %s. (Spoiler alert!)" % QUOTE_SOURCE
+    elif "purpose" in inp:
+        return "These quotes are solely intended for information about joehot200. This service is not intended to make fun of him. Any usage for such purpose is abuse."
+    elif inp.isdigit():
+        try:
+            choice = joehots[int(inp)]
+        except IndexError:
+            return "I'm sorry, but I could not find a quote at this index: " + inp
+    else:
+        choice = random.choice(joehots)
+
+    if "#" in choice:
+        choice = choice[:choice.index("#")]
+
+    if choice == "":
+        return joehot("")
+
+    return u'"%s" \x0308--joehot200' % choice
+
+def refetch_quotes():
+    """ Re-fetches the database from upstream"""
+    global joehots
+
+    try:
+        r = requests.get(QUOTE_SOURCE)
+        joehots = [line.strip() for line in r.text.split("\n")
+                   if not line.startswith("#")]
+        return True
+    except requests.exceptions.RequestException as err:
+        print err.reason
+        return False
+
+refetch_quotes()
-- 
1.8.3.msysgit.0

